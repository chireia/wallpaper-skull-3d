<!DOCTYPE html>
<html lang="en">
  <head>
    <title>xg - skull</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <style>
      :root {
        --mainColor: 255, 0, 0;
      }
      body {
        color: #fff;
        font-family: Monospace;
        font-size: 13px;
        text-align: center;
        font-weight: bold;

        background-color: #000;
        margin: 0px;
        padding: 0px;
      }

      a {
        color: #666;
      }

      #footer {
        position: absolute;
        bottom: 0;
        padding: 1em;
        color: #444;
        z-index: 0;
      }

      #stats {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
      }
      #stats #fps {
        background: transparent !important;
      }
      #stats #fps #fpsText {
        color: #aaa !important;
      }
      #stats #fps #fpsGraph {
        display: none;
      }

      #loading {
        background: #666;
        color: white;
        padding: 0.25em 1em;
        position: absolute;
        right: 0px;
        top: 0px;
        z-index: 200;
      }

      .clock {
        zoom: 60%;
        position: absolute;
        top: 58%;
        left: 71%;
        text-align: center;
        z-index: 1;
      }

      .digit {
        width: 80px;
        height: 140px;
        margin: 0 5px;
        position: relative;
        display: inline-block;
      }

      .digit .segment {
        background: rgba(var(--mainColor), 1);
        border-radius: 5px;
        position: absolute;
        opacity: 0.05;
        transition: opacity 0.2s;
        -webkit-transition: opacity 0.2s;
        -ms-transition: opacity 0.2s;
        -moz-transition: opacity 0.2s;
        -o-transition: opacity 0.2s;
      }

      .digit .segment.on,
      .separator {
        opacity: 1;
        box-shadow: 0px 0px 40px 10px rgba(var(--mainColor), 0.5),
          0px 0px 10px 2px rgba(255, 255, 255, 0.411);
        transition: opacity 0s;
        -webkit-transition: opacity 0s;
        -ms-transition: opacity 0s;
        -moz-transition: opacity 0s;
        -o-transition: opacity 0s;
      }

      .separator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        position: relative;
        top: -65px;
      }

      .digit .segment:nth-child(1) {
        top: 10px;
        left: 20px;
        right: 20px;
        height: 5px;
      }

      .digit .segment:nth-child(2) {
        top: 20px;
        right: 10px;
        width: 5px;
        height: 75px;
        height: calc(50% - 25px);
      }

      .digit .segment:nth-child(3) {
        bottom: 20px;
        right: 10px;
        width: 5px;
        height: 75px;
        height: calc(50% - 25px);
      }

      .digit .segment:nth-child(4) {
        bottom: 10px;
        right: 20px;
        height: 5px;
        left: 20px;
      }

      .digit .segment:nth-child(5) {
        bottom: 20px;
        left: 10px;
        width: 5px;
        height: 75px;
        height: calc(50% - 25px);
      }

      .digit .segment:nth-child(6) {
        top: 20px;
        left: 10px;
        width: 5px;
        height: 75px;
        height: calc(50% - 25px);
      }

      .digit .segment:nth-child(7) {
        bottom: 95px;
        bottom: calc(50% - 5px);
        right: 20px;
        left: 20px;
        height: 5px;
      }
    </style>
  </head>

  <body>
    <div id="loading">Loading ...</div>
    <div class="clock">
      <div class="digit hours">
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
      </div>

      <div class="digit hours">
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
      </div>

      <div class="separator"></div>

      <div class="digit minutes">
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
      </div>

      <div class="digit minutes">
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
      </div>

      <div class="separator"></div>

      <div class="digit seconds">
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
      </div>

      <div class="digit seconds">
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
        <div class="segment"></div>
      </div>
    </div>
    <div id="footer">
      <!--Rendering by <a href="http://alteredqualia.com/" target="_blank">AlteredQualia<a/> | Model by <a href="https://www.artstation.com/artwork/D9dye" target="_blank">Martin Jario</a>-->
    </div>

    <script src="js/xg.min.skull.js"></script>
    <script src="js/libs/stats.min.js"></script>
    <script>
      var digitSegments = [
        [1, 2, 3, 4, 5, 6],
        [2, 3],
        [1, 2, 7, 5, 4],
        [1, 2, 7, 3, 4],
        [6, 7, 2, 3],
        [1, 6, 7, 3, 4],
        [1, 6, 5, 4, 3, 7],
        [1, 2, 3],
        [1, 2, 3, 4, 5, 6, 7],
        [1, 2, 7, 3, 6],
      ];

      document.addEventListener("DOMContentLoaded", function () {
        var _hours = document.querySelectorAll(".hours");
        var _minutes = document.querySelectorAll(".minutes");
        var _seconds = document.querySelectorAll(".seconds");

        setInterval(function () {
          var date = new Date();
          var hours = date.getHours(),
            minutes = date.getMinutes(),
            seconds = date.getSeconds();

          setNumber(_hours[0], Math.floor(hours / 10), 1);
          setNumber(_hours[1], hours % 10, 1);

          setNumber(_minutes[0], Math.floor(minutes / 10), 1);
          setNumber(_minutes[1], minutes % 10, 1);

          setNumber(_seconds[0], Math.floor(seconds / 10), 1);
          setNumber(_seconds[1], seconds % 10, 1);
        }, 1000);
      });

      var setNumber = function (digit, number, on) {
        var segments = digit.querySelectorAll(".segment");
        var current = parseInt(digit.getAttribute("data-value"));

        // only switch if number has changed or wasn't set
        if (!isNaN(current) && current != number) {
          // unset previous number
          digitSegments[current].forEach(function (digitSegment, index) {
            setTimeout(function () {
              segments[digitSegment - 1].classList.remove("on");
            }, index * 45);
          });
        }

        if (isNaN(current) || current != number) {
          // set new number after
          setTimeout(function () {
            digitSegments[number].forEach(function (digitSegment, index) {
              setTimeout(function () {
                segments[digitSegment - 1].classList.add("on");
              }, index * 45);
            });
          }, 250);
          digit.setAttribute("data-value", number);
        }
      };
    </script>
    <script>
      var loadingElement = document.getElementById("loading");
      var footerElement = document.getElementById("footer");

      var hasWebGL1 = Detector.webgl;
      var hasWebGL2 = Detector.webgl2;

      if (!(hasWebGL1 || hasWebGL2)) {
        loadingElement.style.display = "none";
        footerElement.style.display = "none";

        Detector.addGetWebGLMessage({ fallbackImg: "img/skull.jpg" });
      } else {
        var useMRT = true;
        var useDeferred = true;

        var backend = hasWebGL2 ? "webgl2" : "webgl1";
        var isMobile = Detector.isMobile;

        //isMobile = true;

        if (!Detector.deferredCapable || isMobile) useDeferred = false;

        // platform-specific compatibility fixes
        // (mostly things that are supposed to work but are broken anyways)

        var isChrome = navigator.userAgent.toLowerCase().indexOf("chrome") >= 0;
        var isSafari =
          navigator.userAgent.toLowerCase().indexOf("safari") >= 0 && !isChrome;
        var isFirefox =
          navigator.userAgent.toLowerCase().indexOf("firefox") >= 0;
        var isExplorer =
          navigator.userAgent.toLowerCase().indexOf("trident") >= 0;
        var isOSX = navigator.platform.toLowerCase().indexOf("mac") >= 0;

        var SCALE = 1;
        var MARGIN = 0;

        var BRIGHTNESS = 1.0;

        var SCREEN_WIDTH = window.innerWidth;
        var SCREEN_HEIGHT = window.innerHeight - 2 * MARGIN;

        //

        var container, camera, scene, renderer;
        var light;
        var meshBottom;

        var cluts = [];
        var clutIndex = 0;

        var effectFilm, effectColorCorrection, effectColor;

        // ui

        var loadingElement = document.getElementById("loading");
        var loaded = 0;

        var hudVisible = false;

        // camera controls

        var mouseX = 0;
        var mouseY = 0;

        var targetX = 0.0;
        var targetY = 0.0;
        var angle = 0.0;
        var height = 0.0;
        var target = new XG.Vector3();

        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;

        var clock = new XG.Clock();

        var color = 0xff0000;
        //

        init();
        animate();

        function init() {
          container = document.createElement("div");
          document.body.appendChild(container);

          // camera

          camera = new XG.PerspectiveCamera(
            3,
            SCREEN_WIDTH / SCREEN_HEIGHT,
            10,
            3000
          );
          camera.position.set(0, 0, 50);

          // scene

          scene = new XG.Scene();
          scene.add(camera);

          // lights

          light = new XG.SpotLight(0xffffff, 0.2, 200, Math.PI / 4);
          light.position.set(0, 50, 150);
          light.castShadow = true;
          light.shadowMapWidth = 128;
          light.shadowMapHeight = 128;
          light.shadowDarkness = 0.99;

          light.target.position.set(0, 20, 0);
          scene.add(light);

          //

          light = new XG.SpotLight(color, 0.75, 200, Math.PI / 3);
          light.position.set(100, 75, 100);
          light.castShadow = true;
          light.shadowMapWidth = 128;
          light.shadowMapHeight = 128;
          light.shadowDarkness = 0.99;

          // light.target.position.set( 0, 25, 0 );
          scene.add(light);

          //
          light = new XG.SpotLight(0xffffff, 0.25, 200, Math.PI / 3);
          light.position.set(-100, 100, 10);
          light.castShadow = true;
          light.shadowMapWidth = 128;
          light.shadowMapHeight = 128;
          light.shadowDarkness = 0.99;

          light.target.position.set(0, 55, 0);
          scene.add(light);

          //

          light = new XG.SpotLight(0xffffff, 0.35, 200, Math.PI / 3);
          light.position.set(0, 50, 110);
          light.castShadow = true;
          light.shadowMapWidth = 128;
          light.shadowMapHeight = 128;
          light.shadowDarkness = 0.99;

          light.target.position.set(0, 0, 0);
          scene.add(light);

          // objects

          var skyGeo = new XG.SphereGeometry(1500, 32, 16);

          var skyMaterial = new XG.EmissiveMaterial({
            color: 0x334455,
            specular: 0x111111,
            shinines: 100,
            side: XG.BackSide,
            transparent: true,
          });
          skyMaterial.occluder = true;

          sky = new XG.Mesh(skyGeo, skyMaterial);
          sky.position.y = -50;
          scene.add(sky);

          skyMaterial.color.setHSV(0.61, 0.0, 0.05);

          //

          var diffuseMap = XG.ImageUtils.loadTexture(
            "models/ctm/craneo/diffuse.jpg",
            checkLoaded
          );
          var normalMap = XG.ImageUtils.loadTexture(
            "models/ctm/craneo/normal.jpg",
            checkLoaded
          );

          diffuseMap.anisotropy = 8;
          normalMap.anisotropy = 8;

          var material = new XG.PhongMaterial({
            color: 0xffffff,
            specular: 0x111111,
            shininess: 15,
          });
          material.map = diffuseMap;
          material.normalMap = normalMap;
          material.wrapAround = true;
          material.wrapRGB.multiplyScalar(0.75);

          var loader = new XG.CTMLoader();

          var scale = 50;
          var x = 0;
          var y = 0;
          var z = 0;

          loader.load("models/ctm/craneo/craneo-top2.ctm", function (geometry) {
            var modelMesh = new XG.Mesh(geometry, material);

            modelMesh.scale.multiplyScalar(scale);
            modelMesh.position.set(x, y, z);

            modelMesh.castShadow = true;
            modelMesh.receiveShadow = true;

            scene.add(modelMesh);

            checkLoaded();
          });

          loader.load("models/ctm/craneo/craneo-bottom2.ctm", function (
            geometry
          ) {
            var modelMesh = new XG.Mesh(geometry, material);

            modelMesh.scale.multiplyScalar(scale);
            modelMesh.position.set(x, y, z);
            modelMesh.rotation.x = 0.5;

            modelMesh.castShadow = true;
            modelMesh.receiveShadow = true;

            scene.add(modelMesh);

            meshBottom = modelMesh;

            checkLoaded();
          });

          // renderer

          var pars = {
            width: SCREEN_WIDTH,
            height: SCREEN_HEIGHT,
            scale: SCALE,
            antialias: true,
            tonemapping: XG.Filmic2015Operator,
            brightness: BRIGHTNESS,
            clearColor: 0x050505,
            clearAlpha: 1.0,
            useMultipleRenderTargets: useMRT,
            dither: true,
            backend: backend,
          };

          if (useDeferred) {
            renderer = new XG.DeferredRenderer(pars);
          } else {
            renderer = new XG.ForwardRenderer(pars);
          }

          container.appendChild(renderer.domElement);

          renderer.domElement.style.position = "absolute";
          renderer.domElement.style.top = MARGIN + "px";
          renderer.domElement.style.left = "0px";

          //

          renderer.shadowMapEnabled = true;

          renderer.shadowMapDebug = true;

          //renderer.shadowMapCascade = true;
          renderer.shadowMapType = XG.PCFSoftShadowMap;
          //renderer.shadowMapType = XG.PCFSoftHQShadowMap;

          renderer.shadowMapSlopeDepthBias = true;
          renderer.shadowMapSlopeScale = 2;
          renderer.shadowMapSlopeBias = 0.0;
          renderer.shadowMapSlopeMax = 0.1;
          //renderer.shadowMapCullFace = XG.CullFaceBack;
          renderer.shadowMapCullFace = XG.CullFaceNone;

          if (!isOSX) renderer.shadowMapUseDepthTextures = true;

          if (useDeferred) {
            //renderer.ssaoEnabled = true;

            var fovRad = XG.Math.degToRad(camera.fov);
            renderer.dofEnabled = true;
            renderer.dofAutofocus = true;
            renderer.dofFancy = true;
            renderer.dofLensFstop = 1.7;
            renderer.dofLensBlurScale = 3;
            renderer.dofLensFocalLength = fov2flength(fovRad, 24);
            renderer.occludersEnabled = true;

            //
            effectFilm = new XG.ShaderPass(XG.SimpleFilmShader);
            effectFilm.material.uniforms.intensity.value = 0.175;

            clut1 = XG.ImageUtils.loadTexture(
              "textures/clut/fuji_fp-3000b_negative_.png"
            );
            clut1.minFilter = clut1.magFilter = XG.NearestFilter;
            clut1.flipY = false;

            clut2 = XG.ImageUtils.loadTexture(
              "textures/clut/fuji_superia_800_.png"
            );
            clut2.minFilter = clut2.magFilter = XG.NearestFilter;
            clut2.flipY = false;

            cluts.push(clut2, clut1);

            effectColorCorrection = new XG.ShaderPass(XG.CLUTShader);
            effectColorCorrection.material.uniforms.tCLUT.value = clut2;
            effectColorCorrection.enabled = false;

            effectColor = new XG.ShaderPass(XG.ColorCorrectionShader);
            effectColor.material.uniforms.powRGB.value.set(0.85, 0.85, 0.85);
            effectColor.enabled = false;

            renderer.addEffect(effectColorCorrection);
            renderer.addEffect(effectColor);
            renderer.addEffect(effectFilm);
          }

          // stats

          stats = new Stats();
          container.appendChild(stats.domElement);

          // events

          window.addEventListener("resize", onWindowResize, false);
          document.addEventListener("keydown", onKeyDown, false);
          document.addEventListener("mousemove", onDocumentMouseMove, false);
          // renderer.domElement.addEventListener("click", cycleClut, false);
        }

        //

        function checkLoaded() {
          loaded += 1;

          if (loaded >= 3) {
            loadingElement.style.display = "none";
          }
        }

        //

        function fov2flength(verticalFov, frameHeight) {
          return (0.5 * frameHeight) / Math.tan(0.5 * verticalFov);
        }

        function toggleDOF() {
          renderer.setDOF(!renderer.dofEnabled);
        }

        function toggleColorEffect() {
          effectColor.enabled = !effectColor.enabled;
        }

        function toggleColorCorrection() {
          effectColorCorrection.enabled = !effectColorCorrection.enabled;
        }

        function toggleFilm() {
          effectFilm.enabled = !effectFilm.enabled;
        }

        function cycleClut() {
          clutIndex = (clutIndex + 1) % cluts.length;

          var clut = cluts[clutIndex];
          effectColorCorrection.material.uniforms.tCLUT.value = clut;
        }

        function toggleHUD() {
          if (hudVisible) {
            stats.domElement.style.display = "none";
            footerElement.style.display = "none";

            hudVisible = false;
          } else {
            stats.domElement.style.display = "block";
            footerElement.style.display = "block";

            hudVisible = true;
          }
        }

        // event handlers

        function onWindowResize(event) {
          SCREEN_WIDTH = window.innerWidth;
          SCREEN_HEIGHT = window.innerHeight - 2 * MARGIN;

          renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);

          camera.aspect = SCREEN_WIDTH / SCREEN_HEIGHT;
          camera.updateProjectionMatrix();
        }

        function onDocumentMouseMove(event) {
          mouseX = (event.clientX - windowHalfX) * 1;
          mouseY = (event.clientY - windowHalfY) * 1;
        }

        function onKeyDown(event) {
          switch (event.keyCode) {
            case 80:
              /*P*/ toggleDOF();
              break;

            case 49:
              /*1*/ toggleColorCorrection();
              break;
            case 50:
              /*2*/ toggleColorEffect();
              break;
            case 51:
              /*3*/ toggleFilm();
              break;

            case 74:
              /*J*/ toggleHUD();
              break;

            case 32:
              /*space*/ cycleClut();
              break;
          }
        }

        // updates

        function animate() {
          requestAnimationFrame(animate);
          render();

          stats.update();
        }

        function render() {
          var delta = clock.getDelta();

          // update color
          if (color) scene.__lights[1].color = new XG.Color(color);

          // update camera

          targetX = mouseX * 0.04;
          targetY = mouseY * 0.04;

          angle += 0.05 * (targetX - angle);
          height += 0.05 * (targetY - height);

          var d = 3000;

          var x = -Math.sin(angle * 0.02) * d;
          var z = Math.cos(angle * 0.02) * d;
          var y = 20.5 * height - 625;

          camera.position.set(x, y, z);
          camera.lookAt(target);

          if (effectFilm) {
            effectFilm.material.uniforms.time.value += 0.01;
          }

          if (meshBottom) {
            meshBottom.rotation.x =
              (Math.sin(clock.elapsedTime * 2) + 1) *
              (Math.cos(clock.elapsedTime * 3) + 1) *
              0.1;
            meshBottom.position.x = Math.sin(clock.elapsedTime * 0.7) * 0.5;
          }

          // render scene
          renderer.render(scene, camera);
        }
      }
      window.wallpaperPropertyListener = {
        applyUserProperties: function (properties) {
          // Read scheme color
          if (properties.schemecolor) {
            // Convert the scheme color to be applied as a CSS style
            var schemeColor = properties.schemecolor.value.split(" ");
            var schemeColorHex = schemeColor
              .map((v) => Math.ceil(v * 255))
              .toString();
            color = schemeColor.reduce(
              (acc, v) =>
                acc +
                Math.ceil(v * 255)
                  .toString(16)
                  .padStart(2, "0"),
              "#"
            );
            document.documentElement.style.setProperty(
              "--mainColor",
              schemeColorHex
            );
          }
        },
      };
    </script>
  </body>
</html>
